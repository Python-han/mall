<div id="multipleSpec">
    {{ skuSpecs|json_script:"product-data" }}
    {{ specs|json_script:"specs-data"  }}
    <div class="box is-marginless is-radiusless has-background-primary-dark has-text-white-ter">
        <div class="is-flex is-justify-content-space-between is-align-items-center">
            <div>
                <span class="is-size-7"> 原价：¥ <del>{$ sku.retail_price $}</del></span>
                <h1 class="is-size-4">¥ {$ sku.price $}</h1>
            </div>
            <div class=" has-text-centered">
                {$ sku.sales $}
                <h1>销量</h1>
            </div>
        </div>
    </div>


    <!-- specs规格数据获取 -->
    <div class="box is-radiusless is-marginless">
        <div class="is-flex is-align-items-center" v-for="spec, index in specsData" :key="spec.id" style="height:40px;">
            <div class="has-text-grey-light">{$ spec.name $}：</div>
            <div class="is-flex is-flex-wrap-wrap is-flex-grow-1">
                <div class="mr-2" v-for="op, i in spec.baykeshopspecvalue_set" :key="op.id" style="flex: 0 0 25%;">
                    <b-radio-button v-model="radioButton[index]"
                        :native-value="op.id"
                        size="is-small"
                        type="is-primary is-light is-outlined">
                        <span>{$ op.value $}</span>
                    </b-radio-button>
                </div>
            </div>
        </div>

        <!-- 数量 -->
        <div class=" is-flex is-align-items-center mt-3">
            <div class=" has-text-grey-light">数量：</div>
            <div>
                <b-numberinput 
                    controls-position="compact" 
                    min="1" 
                    :max="stock" 
                    v-model="num"
                    size="is-small"
                    :editable="false">
                </b-numberinput> 
            </div>
            <div class=" has-text-grey-dark ml-3">(库存{$ stock $}){{ unit }}</div>
        </div>
        <!-- 数量end -->
    </div>

   

</div>

<script>
    var productData = JSON.parse(document.getElementById('product-data').textContent);
    var specsData = JSON.parse(document.getElementById('specs-data').textContent);
    var multipleSpec = new Vue({
        el: "#multipleSpec",
        delimiters: ['{$', '$}'],
        data: {
            specsData,
            productData,
            specsFormat: {},
            radioButton: [],
            sku: {
                price: 0,
                cost_price: 0,
                sales: 0,
                stock: 0
            },
            stock: 0,
            num: 1,
        },
        created() {
            this.specsFormat = this.getSpecsFormat()
            const skus = productData.filter((el) => el.stock > 0)
            this.radioButton = skus.length ? skus[0].spec_values : []
        },
        watch:{
            radioButton: {
                handler: function(val){
                    let specs = val.join()
                    let item_sku = this.specsFormat[specs]
                    if (item_sku) {
                        this.sku = item_sku
                        this.stock = item_sku.stock
                    }else{
                        this.stock = 0
                    }
                },
                immediate: true,
                deep:true
            }
        },
        methods:{
            getSpecsFormat(){
                let specSkus = {}
                productData.forEach(element => {
                    specSkus[element.spec_values.toString()] = element
                })
                return specSkus
            }
        }
    })
</script>