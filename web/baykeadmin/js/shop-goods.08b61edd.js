"use strict";(self["webpackChunkbaykeshop"]=self["webpackChunkbaykeshop"]||[]).push([[351],{8286:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var l=a(6252);const s={class:"left-panel"},i={class:"right-panel"},r={class:"right-panel-search"},o=(0,l._)("div",{class:"image-slot",style:{"line-height":"50px"}},"-",-1),n=(0,l._)("div",{class:"image-slot",style:{"line-height":"50px"}},"-",-1);function h(e,t,a,h,d,u){const p=(0,l.up)("el-tab-pane"),c=(0,l.up)("el-tabs"),m=(0,l.up)("el-header"),g=(0,l.up)("sc-select-filter"),w=(0,l.up)("el-button"),b=(0,l.up)("el-input"),f=(0,l.up)("el-table-column"),y=(0,l.up)("el-image"),_=(0,l.up)("el-switch"),W=(0,l.up)("el-popconfirm"),$=(0,l.up)("el-button-group"),C=(0,l.up)("scTable"),k=(0,l.up)("el-main"),v=(0,l.up)("el-container");return(0,l.wg)(),(0,l.j4)(v,null,{default:(0,l.w5)((()=>[(0,l.Wm)(m,{class:"header-tabs"},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{type:"card",modelValue:d.groupId,"onUpdate:modelValue":t[0]||(t[0]=e=>d.groupId=e),onTabChange:u.tabChange},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{label:"出售中",name:"1"}),(0,l.Wm)(p,{label:"仓库中",name:"2"}),(0,l.Wm)(p,{label:"已售罄",name:"3"}),(0,l.Wm)(p,{label:"警戒库存",name:"4"}),(0,l.Wm)(p,{label:"回收站",name:"5"})])),_:1},8,["modelValue","onTabChange"])])),_:1}),(0,l.Wm)(m,{style:{height:"auto"}},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{data:d.filterData,"label-width":80,onOnChange:u.filterChange},null,8,["data","onOnChange"])])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l._)("div",s,[(0,l.Wm)(w,{type:"primary",icon:"el-icon-plus",onClick:u.addPage},{default:(0,l.w5)((()=>[(0,l.Uk)("新增")])),_:1},8,["onClick"]),(0,l.Wm)(w,{type:"danger",plain:"",icon:"el-icon-delete",disabled:0==d.selection.length,onClick:u.batch_del},{default:(0,l.w5)((()=>[(0,l.Uk)("批量删除")])),_:1},8,["disabled","onClick"])]),(0,l._)("div",i,[(0,l._)("div",r,[(0,l.Wm)(b,{modelValue:d.search.keyword,"onUpdate:modelValue":t[1]||(t[1]=e=>d.search.keyword=e),placeholder:"商品名称",clearable:""},null,8,["modelValue"]),(0,l.Wm)(w,{type:"primary",icon:"el-icon-search",onClick:u.upsearch},null,8,["onClick"])])])])),_:1}),(0,l.Wm)(k,{class:"nopadding"},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{ref:"table",apiObj:d.apiObj,"row-key":"id",onSelectionChange:u.selectionChange,params:{groupId:"1"}},{default:(0,l.w5)((()=>[(0,l.Wm)(f,{type:"selection",width:"50"}),(0,l.Wm)(f,{label:"ID",prop:"id",width:"50"}),(0,l.Wm)(f,{label:"标题",prop:"title",width:"300"}),(0,l.Wm)(f,{label:"商品图",prop:"images",width:"150"},{default:(0,l.w5)((e=>[(0,l.Wm)(y,{src:u.img(e.row.images),style:{width:"50px",height:"50px"},fit:"cover","preview-src-list":u.imgs(e.row.images),"preview-teleported":!0},{placeholder:(0,l.w5)((()=>[o])),error:(0,l.w5)((()=>[n])),_:2},1032,["src","preview-src-list"])])),_:1}),(0,l.Wm)(f,{label:"库存",prop:"stock",width:"80"}),(0,l.Wm)(f,{label:"销量",prop:"sales",width:"80"}),(0,l.Wm)(f,{label:"排序",prop:"sort",width:"100"}),(0,l.Wm)(f,{label:"状态",prop:"status",width:"150"},{default:(0,l.w5)((e=>[(0,l.Wm)(_,{modelValue:e.row.status,"onUpdate:modelValue":t=>e.row.status=t,onChange:t=>u.changeSwitch(t,e.row),loading:e.row.$switch_status,"active-value":!0,"inactive-value":!1,"active-text":"上架","inactive-text":"下架","inline-prompt":""},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])])),_:1}),(0,l.Wm)(f,{label:"创建时间",prop:"add_date",width:"180"}),(0,l.Wm)(f,{label:"操作",fixed:"right",align:"right",width:"270"},{default:(0,l.w5)((e=>[(0,l.Wm)($,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,{text:"",type:"primary",size:"small",onClick:t=>u.table_show(e.row,e.$index)},{default:(0,l.w5)((()=>[(0,l.Uk)("查看")])),_:2},1032,["onClick"]),(0,l.Wm)(w,{text:"",type:"primary",size:"small",onClick:t=>u.table_edit_page(e.row,e.$index)},{default:(0,l.w5)((()=>[(0,l.Uk)("编辑")])),_:2},1032,["onClick"]),(0,l.Wm)(W,{title:"确定删除吗？",onConfirm:t=>u.table_del(e.row,e.$index)},{reference:(0,l.w5)((()=>[(0,l.Wm)(w,{text:"",type:"primary",size:"small"},{default:(0,l.w5)((()=>[(0,l.Uk)("删除")])),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)])),_:1})])),_:1},8,["apiObj","onSelectionChange"])])),_:1})])),_:1})}a(7658);var d=a(9634),u=a(907),p={name:"shopGoods",components:{scSelectFilter:d.Z},data(){return{dialog:{save:!1,drawer:!1},drawerData:"",apiObj:this.$API.shop.spu.list,selection:[],search:{keyword:null},ids:[],groupId:"1",filterData:[{title:"所属分类",key:"category",multiple:!0,options:[{label:"全部",value:0}]},{title:"所属品牌",key:"brand",options:[{label:"全部",value:0}]}]}},created(){this.getGoodsCategory(),this.getBrands()},beforeRouteEnter(e,t,a){a((()=>{t.is&&(delete t.is,u.Z.refresh())}))},methods:{img(e){return e.length?e[0].url:""},imgs(e){let t=[];return e.length&&e.forEach((e=>{t.push(e.url)})),t},addPage(){this.$router.push({path:"/shop/goods/detail"})},table_edit_page(e){this.$router.push({path:"/shop/goods/detail",query:{id:e.id}})},table_show(e){this.$router.push({path:"/shop/goods/detail",query:{id:e.id,mode:"show"}})},async table_del(e){var t=await this.$API.shop.spu.remove.delete(e.id);204==t.status?(this.$refs.table.refresh(),this.$message.success("删除成功")):this.$alert(t.message,"提示",{type:"error"})},async batch_del(){this.$confirm(`确定删除选中的 ${this.selection.length} 项吗？如果删除项中含有子集将会被一并删除`,"提示",{type:"warning"}).then((()=>{const e=this.$loading();this.$API.shop.spu.remove.batch_delete({ids:this.ids}).then((t=>{204==t.status&&(this.$refs.table.refresh(),e.close(),this.$message.success("操作成功"))}))})).catch((()=>{}))},selectionChange(e){this.selection=e,this.selection.forEach((e=>{this.ids.push(e.id)}))},upsearch(){this.$refs.table.upData({search:this.search.keyword})},tabChange(e){var t={groupId:e};this.$refs.table.reload(t)},filterChange(e){this.$refs.table.upData(e)},handleSaveSuccess(e,t){("add"==t||"edit"==t)&&this.$refs.table.refresh()},changeSwitch(e,t){t.$switch_status=!0,this.$API.shop.spu.partial_update.patch(t.id,{status:e}).then((a=>{200==a.status?(delete t.$switch_status,t.status=e,this.$refs.table.refresh(),this.$message.success("操作成功")):(delete t.$switch_status,t.status=!e,this.$message.success("操作失败，请检查！"))}))},async getGoodsCategory(){const e=await this.$API.shop.category.list.get();let t=this.treeToArray(e.data.results);t.forEach((e=>{this.filterData[0]["options"].push({label:e.name,value:e.id})}))},async getBrands(){const e=await this.$API.shop.brand.list.get();e.data.results.forEach((e=>{this.filterData[1]["options"].push({label:e.name,value:e.id})}))},treeToArray(e){return e.reduce(((e,t)=>{const{children:a,...l}=t;return e.concat(l,a&&a.length?this.treeToArray(a):[])}),[])}}},c=a(3744);const m=(0,c.Z)(p,[["render",h]]);var g=m}}]);