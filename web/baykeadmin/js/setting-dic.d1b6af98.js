"use strict";(self["webpackChunkbaykeshop"]=self["webpackChunkbaykeshop"]||[]).push([[5825],{6137:function(e,i,t){t.r(i),t.d(i,{default:function(){return b}});var s=t(6252),a=t(3577),l=t(9963);const d={class:"custom-tree-node"},c={class:"label"},n={class:"code"},o={class:"do"},r={class:"left-panel"};function h(e,i,t,h,u,p){const m=(0,s.up)("el-input"),f=(0,s.up)("el-header"),g=(0,s.up)("el-button"),w=(0,s.up)("el-button-group"),b=(0,s.up)("el-tree"),$=(0,s.up)("el-main"),_=(0,s.up)("el-footer"),k=(0,s.up)("el-container"),y=(0,s.up)("el-aside"),v=(0,s.up)("el-table-column"),D=(0,s.up)("el-icon-d-caret"),C=(0,s.up)("el-tag"),W=(0,s.up)("el-switch"),x=(0,s.up)("el-popconfirm"),A=(0,s.up)("scTable"),P=(0,s.up)("dic-dialog"),S=(0,s.up)("list-dialog"),I=(0,s.Q2)("loading");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(k,null,{default:(0,s.w5)((()=>[(0,s.wy)(((0,s.wg)(),(0,s.j4)(y,{width:"300px"},{default:(0,s.w5)((()=>[(0,s.Wm)(k,null,{default:(0,s.w5)((()=>[(0,s.Wm)(f,null,{default:(0,s.w5)((()=>[(0,s.Wm)(m,{placeholder:"输入关键字进行过滤",modelValue:u.dicFilterText,"onUpdate:modelValue":i[0]||(i[0]=e=>u.dicFilterText=e),clearable:""},null,8,["modelValue"])])),_:1}),(0,s.Wm)($,{class:"nopadding"},{default:(0,s.w5)((()=>[(0,s.Wm)(b,{ref:"dic",class:"menu","node-key":"id",data:u.dicList,props:u.dicProps,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":p.dicFilterNode,onNodeClick:p.dicClick},{default:(0,s.w5)((({node:e,data:i})=>[(0,s._)("span",d,[(0,s._)("span",c,(0,a.zw)(e.label),1),(0,s._)("span",n,(0,a.zw)(i.code),1),(0,s._)("span",o,[(0,s.Wm)(w,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g,{icon:"el-icon-edit",size:"small",onClick:(0,l.iM)((e=>p.dicEdit(i)),["stop"])},null,8,["onClick"]),(0,s.Wm)(g,{icon:"el-icon-delete",size:"small",onClick:(0,l.iM)((t=>p.dicDel(e,i)),["stop"])},null,8,["onClick"])])),_:2},1024)])])])),_:1},8,["data","props","filter-node-method","onNodeClick"])])),_:1}),(0,s.Wm)(_,{style:{height:"51px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{type:"primary",size:"small",icon:"el-icon-plus",style:{width:"100%"},onClick:p.addDic},{default:(0,s.w5)((()=>[(0,s.Uk)("字典分类")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})),[[I,u.showDicloading]]),(0,s.Wm)(k,{class:"is-vertical"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,null,{default:(0,s.w5)((()=>[(0,s._)("div",r,[(0,s.Wm)(g,{type:"primary",icon:"el-icon-plus",onClick:p.addInfo},{default:(0,s.w5)((()=>[(0,s.Uk)("新增")])),_:1},8,["onClick"]),(0,s.Wm)(g,{type:"danger",plain:"",icon:"el-icon-delete",disabled:0==u.selection.length,onClick:p.batch_del},{default:(0,s.w5)((()=>[(0,s.Uk)("批量删除")])),_:1},8,["disabled","onClick"])])])),_:1}),(0,s.Wm)($,{class:"nopadding"},{default:(0,s.w5)((()=>[(0,s.Wm)(A,{ref:"table",apiObj:u.listApi,"row-key":"id",params:u.listApiParams,onSelectionChange:p.selectionChange,stripe:"",paginationLayout:"prev, pager, next"},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{type:"selection",width:"50"}),(0,s.Wm)(v,{label:"",width:"60"},{default:(0,s.w5)((()=>[(0,s.Wm)(C,{class:"move",style:{cursor:"move"}},{default:(0,s.w5)((()=>[(0,s.Wm)(D,{style:{width:"1em",height:"1em"}})])),_:1})])),_:1}),(0,s.Wm)(v,{label:"名称",prop:"name",width:"150"}),(0,s.Wm)(v,{label:"键值",prop:"key",width:"150"}),(0,s.Wm)(v,{label:"是否有效",prop:"status",width:"100"},{default:(0,s.w5)((e=>[(0,s.Wm)(W,{modelValue:e.row.status,"onUpdate:modelValue":i=>e.row.status=i,onChange:i=>p.changeSwitch(i,e.row),loading:e.row.$switch_yx,"active-value":!0,"inactive-value":!1},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])])),_:1}),(0,s.Wm)(v,{label:"操作",fixed:"right",align:"right",width:"120"},{default:(0,s.w5)((e=>[(0,s.Wm)(w,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g,{text:"",type:"primary",size:"small",onClick:i=>p.table_edit(e.row,e.$index)},{default:(0,s.w5)((()=>[(0,s.Uk)("编辑")])),_:2},1032,["onClick"]),(0,s.Wm)(x,{title:"确定删除吗？",onConfirm:i=>p.table_del(e.row,e.$index)},{reference:(0,s.w5)((()=>[(0,s.Wm)(g,{text:"",type:"primary",size:"small"},{default:(0,s.w5)((()=>[(0,s.Uk)("删除")])),_:1})])),_:2},1032,["onConfirm"])])),_:2},1024)])),_:1})])),_:1},8,["apiObj","params","onSelectionChange"])])),_:1})])),_:1})])),_:1}),u.dialog.dic?((0,s.wg)(),(0,s.j4)(P,{key:0,ref:"dicDialog",onSuccess:p.handleDicSuccess,onClosed:i[1]||(i[1]=e=>u.dialog.dic=!1)},null,8,["onSuccess"])):(0,s.kq)("",!0),u.dialog.list?((0,s.wg)(),(0,s.j4)(S,{key:1,ref:"listDialog",onSuccess:p.handleListSuccess,onClosed:i[2]||(i[2]=e=>u.dialog.list=!1)},null,8,["onSuccess"])):(0,s.kq)("",!0)],64)}t(7658);var u=t(4913),p=t(1607),m=t(1474),f={name:"dic",components:{dicDialog:u["default"],listDialog:p["default"]},data(){return{dialog:{dic:!1,info:!1},showDicloading:!0,dicList:[],dicFilterText:"",dicProps:{label:"name"},listApi:null,listApiParams:{},selection:[],ids:[]}},watch:{dicFilterText(e){this.$refs.dic.filter(e)}},mounted(){this.getDic(),this.rowDrop()},methods:{async getDic(){var e=await this.$API.badmin.dictkey.list.get();this.showDicloading=!1,this.dicList=e.data;var i=this.dicList[0];i&&(this.$nextTick((()=>{this.$refs.dic.setCurrentKey(i.id)})),this.listApiParams={dic__code:i.code},this.listApi=this.$API.badmin.dictvalue.list)},dicFilterNode(e,i){if(!e)return!0;var t=i.name+i.code;return-1!==t.indexOf(e)},addDic(){this.dialog.dic=!0,this.$nextTick((()=>{this.$refs.dicDialog.open()}))},dicEdit(e){this.dialog.dic=!0,this.$nextTick((()=>{var i=this.$refs.dic.getNode(e.id),t=1==i.level?void 0:i.parent.data.id;e.parent=t,this.$refs.dicDialog.open("edit").setData(e)}))},dicClick(e){this.$refs.table.reload({dic__code:e.code})},dicDel(e,i){this.$confirm(`确定删除 ${i.name} 项吗？`,"提示",{type:"warning"}).then((()=>{this.showDicloading=!0,this.$API.badmin.dictkey.remove.delete(i.id).then((e=>{if(204==e.status){var t=this.$refs.dic.getCurrentKey();if(this.$refs.dic.remove(i.id),t==i.id){var s=this.dicList[0];s?(this.$refs.dic.setCurrentKey(s.id),this.$refs.table.upData({code:s.code})):(this.listApi=null,this.$refs.table.tableData=[])}this.showDicloading=!1,this.$message.success("操作成功")}}))})).catch((()=>{}))},rowDrop(){const e=this,i=this.$refs.table.$el.querySelector(".el-table__body-wrapper tbody");m.ZP.create(i,{handle:".move",animation:300,ghostClass:"ghost",onEnd({newIndex:i,oldIndex:t}){const s=e.$refs.table.tableData,a=s.splice(t,1)[0];s.splice(i,0,a),e.$message.success("排序成功")}})},addInfo(){this.dialog.list=!0,this.$nextTick((()=>{var e=this.$refs.dic.getCurrentKey();const i={dic:e};this.$refs.listDialog.open().setData(i)}))},table_edit(e){this.dialog.list=!0,this.$nextTick((()=>{this.$refs.listDialog.open("edit").setData(e)}))},async table_del(e,i){var t={id:e.id},s=await this.$API.badmin.dictvalue.remove.delete(t.id);204==s.status?(this.$refs.table.tableData.splice(i,1),this.$message.success("删除成功")):this.$alert(s.message,"提示",{type:"error"})},async batch_del(){this.$confirm(`确定删除选中的 ${this.selection.length} 项吗？`,"提示",{type:"warning"}).then((()=>{const e=this.$loading();this.$API.badmin.dictvalue.remove.batch_delete({ids:this.ids}).then((i=>{204==i.status&&(this.selection.forEach((e=>{this.$refs.table.tableData.forEach(((i,t)=>{e.id===i.id&&this.$refs.table.tableData.splice(t,1)}))})),e.close(),this.$message.success("操作成功"))}))})).catch((()=>{}))},selectionChange(e){this.selection=e,this.selection.forEach((e=>{this.ids.push(e.id)}))},changeSwitch(e,i){i.status=1!=i.status,i.$switch_yx=!0,this.$API.badmin.dictvalue.partial_update.patch(i.id,{status:e}).then((t=>{console.log(t),200==t.status&&(delete i.$switch_yx,i.status=e,this.$message.success("操作成功"))}))},handleDicSuccess(e,i){if("add"==i)this.dicList.length>0?this.$refs.table.upData({dic__code:e.code}):(this.listApiParams={dic__code:e.code},this.listApi=this.$API.badmin.dic.list),this.$refs.dic.append(e,e.parent),this.$refs.dic.setCurrentKey(e.id);else if("edit"==i){var t=this.$refs.dic.getNode(e.id),s=1==t.level?void 0:t.parent.data.id;if(s!=e.parent){var a=t.data;this.$refs.dic.remove(e.id),this.$refs.dic.append(a,e.parent)}Object.assign(t.data,e)}},handleListSuccess(e,i){"add"==i?this.$refs.table.tableData.push(e):"edit"==i&&this.$refs.table.tableData.filter((i=>i.id===e.id)).forEach((i=>{Object.assign(i,e)}))}}},g=t(3744);const w=(0,g.Z)(f,[["render",h],["__scopeId","data-v-076fcc5c"]]);var b=w}}]);