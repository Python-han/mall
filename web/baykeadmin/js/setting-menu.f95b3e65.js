"use strict";(self["webpackChunkbaykeshop"]=self["webpackChunkbaykeshop"]||[]).push([[7465,7923],{6682:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var n=a(6252),s=a(3577),i=a(9963);const l={class:"custom-tree-node"},d={class:"label"},o={class:"do"};function r(e,t,a,r,u,m){const c=(0,n.up)("el-input"),p=(0,n.up)("el-header"),h=(0,n.up)("el-button"),f=(0,n.up)("el-tree"),g=(0,n.up)("el-main"),v=(0,n.up)("el-footer"),w=(0,n.up)("el-container"),$=(0,n.up)("el-aside"),k=(0,n.up)("save"),b=(0,n.Q2)("loading");return(0,n.wg)(),(0,n.j4)(w,null,{default:(0,n.w5)((()=>[(0,n.wy)(((0,n.wg)(),(0,n.j4)($,{width:"300px"},{default:(0,n.w5)((()=>[(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c,{placeholder:"输入关键字进行过滤",modelValue:u.menuFilterText,"onUpdate:modelValue":t[0]||(t[0]=e=>u.menuFilterText=e),clearable:""},null,8,["modelValue"])])),_:1}),(0,n.Wm)(g,{class:"nopadding"},{default:(0,n.w5)((()=>[(0,n.Wm)(f,{ref:"menu",class:"menu","node-key":"id",data:u.menuList,props:u.menuProps,draggable:"","highlight-current":"","expand-on-click-node":!1,"check-strictly":"","show-checkbox":"","filter-node-method":m.menuFilterNode,onNodeClick:m.menuClick,onNodeDrop:m.nodeDrop},{default:(0,n.w5)((({node:e,data:t})=>[(0,n._)("span",l,[(0,n._)("span",d,(0,s.zw)(e.label),1),(0,n._)("span",o,[(0,n.Wm)(h,{icon:"el-icon-plus",size:"small",onClick:(0,i.iM)((a=>m.add(e,t)),["stop"])},null,8,["onClick"])])])])),_:1},8,["data","props","filter-node-method","onNodeClick","onNodeDrop"])])),_:1}),(0,n.Wm)(v,{style:{height:"51px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{type:"primary",size:"small",icon:"el-icon-plus",onClick:t[1]||(t[1]=e=>m.add())}),(0,n.Wm)(h,{type:"danger",size:"small",plain:"",icon:"el-icon-delete",onClick:m.delMenu},null,8,["onClick"])])),_:1})])),_:1})])),_:1})),[[b,u.menuloading]]),(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g,{class:"nopadding",style:{padding:"20px"},ref:"main"},{default:(0,n.w5)((()=>[(0,n.Wm)(k,{ref:"save",menu:u.menuList},null,8,["menu"])])),_:1},512)])),_:1})])),_:1})}var u=a(1795);let m=1;var c={name:"settingMenu",components:{save:u["default"]},data(){return{menuloading:!1,menuList:[],menuProps:{label:e=>e.meta.title},menuFilterText:""}},watch:{menuFilterText(e){this.$refs.menu.filter(e)}},mounted(){this.getMenu()},methods:{async getMenu(){this.menuloading=!0;var e=await this.$API.badmin.menus.list.get();this.menuloading=!1,this.menuList=e.data},menuClick(e,t){var a=1==t.level?void 0:t.parent.data.id;this.$refs.save.setData(e,a),this.$refs.main.$el.scrollTop=0},menuFilterNode(e,t){if(!e)return!0;var a=t.meta.title;return-1!==a.indexOf(e)},nodeDrop(e,t,a){this.$refs.save.setData({});let n="before"==a?t.data.sort-1:t.data.sort+1;this.$API.badmin.menus.partial_update.patch(e.data.id,{sort:n}).then((e=>{200==e.status&&this.$message.success("顺序修改成功，重新登录后生效！")}))},async add(e,t){var a=`未命名${Math.floor(50*Math.random())}`+m++,n={parentId:t?t.id:"",parent:t?t.id:"",name:a,path:"",component:"",meta:{title:a,type:"menu"}};this.menuloading=!0;try{var s=await this.$API.badmin.menus.create.post(n)}catch(l){console.log(l)}this.menuloading=!1,n.id=s.data.id,this.$refs.menu.append(n,e),this.$refs.menu.setCurrentKey(n.id);var i=e?e.data.id:"";this.$refs.save.setData(n,i)},async delMenu(){var e=this.$refs.menu.getCheckedNodes();if(0==e.length)return this.$message.warning("请选择需要删除的项"),!1;var t=await this.$confirm("确认删除已选择的菜单吗？","提示",{type:"warning",confirmButtonText:"删除",confirmButtonClass:"el-button--danger"}).catch((()=>{}));if("confirm"!=t)return!1;this.menuloading=!0;var a={ids:e.map((e=>e.id))},n=await this.$API.badmin.menus.remove.batch_delete(a);this.menuloading=!1,204==n.status?e.forEach((e=>{var t=this.$refs.menu.getNode(e);t.isCurrent&&this.$refs.save.setData({}),this.$refs.menu.remove(e)})):this.$message.warning(n.message)}}},p=a(3744);const h=(0,p.Z)(c,[["render",r],["__scopeId","data-v-129b60c7"]]);var f=h}}]);